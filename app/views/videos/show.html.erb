<div class="bg-black min-h-screen pb-24">

  <!-- Player â€” edge to edge on mobile -->
  <div class="bg-black" style="aspect-ratio: 16/9;">
    <video
      id="video-player"
      controls
      controlsList="nodownload"
      oncontextmenu="return false"
      class="w-full h-full"
      preload="metadata"
      playsinline
      data-hls="<%= @video.hls_ready? ? @video.signed_hls_url : '' %>"
      data-fallback="<%= @video.video_file.url %>"
    >
    </video>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.13/dist/hls.min.js"></script>
  <script>
    (function() {
      const video  = document.getElementById('video-player');
      const hlsSrc = video.dataset.hls;
      const mp4Src = video.dataset.fallback;

      if (hlsSrc && Hls.isSupported()) {
        const hls = new Hls({ maxMaxBufferLength: 30, enableWorker: true });
        hls.loadSource(hlsSrc);
        hls.attachMedia(video);
      } else if (hlsSrc && video.canPlayType('application/vnd.apple.mpegurl')) {
        // Safari native HLS
        video.src = hlsSrc;
      } else if (mp4Src) {
        // Fallback: direct mp4 (dev / pre-transcode)
        video.src = mp4Src;
      }
    })();
  </script>

  <!-- Title + meta -->
  <div class="px-5 pt-5 pb-4 border-b border-white/5">
    <% if @video.category %>
      <p class="text-red-400 text-[10px] font-black tracking-widest uppercase mb-2">
        <%= Video::CATEGORY_LABELS[@video.category] %>
      </p>
    <% end %>
    <h1 class="text-lg font-black text-white leading-tight mb-2"><%= @video.title %></h1>
    <p class="text-white/30 text-xs">
      <%= @video.created_at.strftime("%B %d, %Y") %>
      <% if @video.views_count > 0 %>
        &middot; <%= @video.views_count %> views
      <% end %>
      <% if @video.duration_seconds %>
        &middot; <%= @video.formatted_duration %>
      <% end %>
    </p>
  </div>

  <!-- Description -->
  <% if @video.description.present? %>
    <div class="px-5 py-5 border-b border-white/5">
      <p class="text-white/60 text-sm leading-relaxed"><%= simple_format @video.description %></p>
    </div>
  <% end %>

  <!-- Up next -->
  <% if @up_next.any? %>
    <div class="px-5 pt-6">
      <h2 class="text-white font-black text-sm mb-4">Up Next</h2>
      <div class="space-y-3">
        <% @up_next.each do |video| %>
          <%= link_to video_path(video), class: "flex gap-3 group" do %>
            <div class="rounded-xl overflow-hidden shrink-0" style="width: 120px; aspect-ratio: 16/9; background: #111;">
              <% if video.thumbnail.present? %>
                <img src="<%= video.thumbnail.url %>" class="w-full h-full object-cover group-hover:scale-105 transition duration-300" alt="">
              <% else %>
                <div class="w-full h-full bg-zinc-900 flex items-center justify-center">
                  <svg class="w-5 h-5 text-zinc-700" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </div>
              <% end %>
            </div>
            <div class="flex-1 min-w-0 py-0.5">
              <% if video.category %>
                <p class="text-red-400/70 text-[10px] font-bold tracking-widest uppercase mb-1">
                  <%= Video::CATEGORY_LABELS[video.category] %>
                </p>
              <% end %>
              <p class="text-white text-sm font-semibold leading-snug line-clamp-2 group-hover:text-red-400 transition"><%= video.title %></p>
              <% if video.duration_seconds %>
                <p class="text-white/30 text-xs mt-1"><%= video.formatted_duration %></p>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

</div>
